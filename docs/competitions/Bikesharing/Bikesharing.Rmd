---
title: "Bike sharing"
author: Aldo Solari
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightLanguage: R
      countIncrementalSlides: false
      highlightLines: true   
---

```{r startup, include = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = T, eval=T, message=F, warning=F, error=F, comment=NA, cache=F, R.options=list(width=220))
```

# Outline

* Description
* Data
* Evaluation
* Benchmark
* Timeline


---

# Bike sharing

* Bike sharing systems are a means of renting bicycles where the process of obtaining membership, rental, and bike return is automated via a network of kiosk locations throughout a city. Using these systems, people are able rent a bike from a one location and return it to a different place on an as-needed basis. Currently, there are over 500 bike-sharing programs around the world.

* The data generated by these systems makes them attractive for researchers because the duration of travel, departure location, arrival location, and time elapsed is explicitly recorded. Bike sharing systems therefore function as a sensor network, which can be used for studying mobility in a city. In this competition, participants are asked to combine historical usage patterns with weather data in order to forecast bike rental demand.

* Team: Yes (1st round and attending students)

* Weight: 1/3

---

# Data

You are provided hourly rental data spanning two years. For this competition, the training set is comprised of the first 19 days of each month, while the test set is the 20th to the end of the month. You must predict the total count of bikes rented during each hour covered by the test set, using only information available prior to the rental period.

---

# Variables

* datetime - hourly date + timestamp  
* season -  1 = spring, 2 = summer, 3 = fall, 4 = winter 
* holiday - whether the day is considered a holiday
* workingday - whether the day is neither a weekend nor holiday
* weather 
    - 1: Clear, Few clouds, Partly cloudy, Partly cloudy 
    - 2: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist 
    - 3: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain Scattered clouds 
    - 4: Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog 
* temp - temperature in Celsius
* atemp - "feels like" temperature in Celsius
* humidity - relative humidity
* windspeed - wind speed
* casual - number of non-registered user rentals initiated
* registered - number of registered user rentals initiated
* __count__ - number of total rentals (RESPONSE)

---

# Evaluation

Submissions are evaluated by the __Root Mean Squared Logarithmic Error__ (RMSLE). The RMSLE is calculated as
$$\mathrm{RMSLE}=\sqrt{\frac{1}{m}\sum_{i=1}^{m}(\log(y_i+1) - \log(\hat{y}_i+1))^2}$$
where:
* $m$ is the number of hours in the test set
* $y_i$ is the actual count
* $\hat{y}_i$ is your predicted count
* $log(x)$ is the natural logarithm

During the competition, the leaderboard displays your partial score, which is the RMSLE for 3000 (random) observations of the test set.

At the end of the contest, the leaderboard will display the final score, which is the RMSLE for the remaining 3493 observations of the test set. The final score will determine the final winner. This method prevents users from overfitting to the leaderboard.

---

# Points

The % of __points__ will be calculated as
$$\frac{x-m}{M-m}$$
 where
* $x$ is your final score
* $M$ is the best score (among participants)
* $m$ is the benchmark score

However, I reserve the right to regrade differently (meaning your % of points may be calculated differently)

---


```{r, eval=FALSE}
# Benchmark
library(fasttime)
library(lubridate)
library(rpart)

train <- read.csv("99.csv", stringsAsFactors=T)
test <- read.csv("100.csv", , stringsAsFactors=F)
train$count = log1p(train$count)

train %>% 
  mutate(datetime = fastPOSIXct(datetime, "GMT")) %>% 
  mutate(hour = hour(datetime),
         month = month(datetime),
         year = year(datetime),
         wday = wday(datetime)) -> train

test %>% 
  mutate(datetime = fastPOSIXct(datetime, "GMT")) %>% 
  mutate(hour = hour(datetime),
         month = month(datetime),
         year = year(datetime),
         wday = wday(datetime)) -> test


fml <- count ~ season + holiday + workingday + weather + temp + atemp + humidity + hour
fit <- rpart(fml, data=train)
yhat <- expm1(predict(fit, newdata=test))
write.table(file="mybike.txt", yhat, row.names = FALSE, col.names = FALSE)
```

---

# Timeline

Entry: October 16

Final submission: November 16

The R code used to get the predictions __must be published online__ by November 17. 
Keep only the necessary code (no plots, numeric summaries etc. )

