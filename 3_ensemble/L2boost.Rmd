---
title: "Boosting with squared error loss"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("/Users/aldosolari/Desktop/DM_off/3_ensemble/code")
```

## Import

```{r}
load("poly250.Rdata")
set.seed(123)
y = f + rnorm(250,0,.01)
train = data.frame(x,y)
```

## Boosting regression trees

```{r}
library(rpart)

B = 200+1
lambda = 0.1
d = 1
n = length(y)

# 1.
r = y - mean(y)
fx = matrix(NA, nrow=n, ncol=B)
fx[,1] = rep(mean(y),n)


# 2.
for (b in 2:B){
  # a
  fxb = rpart(r~x, control=rpart.control(maxdepth = d))
  # b
  fx[,b] = fx[,b-1] + lambda*predict(fxb)
  # c
  r = r - lambda*predict(fxb)
  
}



# 3.

f.boost = fx[,B]

plot(x,f, col=2, type="l")
lines(x,f.boost, type="s", col="blue")

plot(x,r)
fxb = rpart(r~x, control=rpart.control(maxdepth = d))
lines(x,predict(fxb))
```